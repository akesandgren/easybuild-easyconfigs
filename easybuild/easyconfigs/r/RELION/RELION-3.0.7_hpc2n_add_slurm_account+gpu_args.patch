This is a HPC2N specific patch.
It adds "account" and GPU specification arguments to the GUI,
and gres arguments to the submit file.

Ã…ke Sandgren, 2020-03-04
diff -ru relion-3.0.7.orig/src/gui_jobwindow.cpp relion-3.0.7/src/gui_jobwindow.cpp
--- relion-3.0.7.orig/src/gui_jobwindow.cpp	2020-03-04 08:59:00.820992331 +0100
+++ relion-3.0.7/src/gui_jobwindow.cpp	2020-03-04 09:08:09.718681235 +0100
@@ -243,7 +243,10 @@
         place("qsub");
 	place("queuename");
 
+	place("account");
 	place("timelimit");
+	place("gputype");
+	place("ngpu");
 	place("extrasbatch");
 
 	char * extra_count_text = getenv ("RELION_QSUB_EXTRA_COUNT");
diff -ru relion-3.0.7.orig/src/pipeline_jobs.cpp relion-3.0.7/src/pipeline_jobs.cpp
--- relion-3.0.7.orig/src/pipeline_jobs.cpp	2020-03-04 09:00:45.359789713 +0100
+++ relion-3.0.7/src/pipeline_jobs.cpp	2020-03-04 09:08:09.722681189 +0100
@@ -460,11 +460,24 @@
                 } else {
                     replacing["XXXqueueXXX"] = "";
                 }
+                if (!joboptions["account"].getString().empty()) {
+                    replacing["XXXaccountXXX"] = "-A " + joboptions["account"].getString();
+                } else {
+                    replacing["XXXaccountXXX"] = "";
+                }
                 if (!joboptions["timelimit"].getString().empty()) {
                     replacing["XXXtimelimitXXX"] = "-t " + joboptions["timelimit"].getString();
                 } else {
                     replacing["XXXtimelimitXXX"] = "";
                 }
+                if (!joboptions["gputype"].getString().empty()) {
+                    replacing["XXXgpuspecXXX"] = "--gres=gpu:" + joboptions["gputype"].getString();
+                    if (!joboptions["ngpu"].getString().empty()) {
+                        replacing["XXXgpuspecXXX"] += ":" + joboptions["ngpu"].getString();
+                    }
+                } else {
+                    replacing["XXXgpuspecXXX"] = "";
+                }
                 replacing["XXXextrasbatchXXX"] = joboptions["extrasbatch"].getString();
 		char * extra_count_text = getenv ("RELION_QSUB_EXTRA_COUNT");
 		const char extra_count_val = (extra_count_text ? atoi(extra_count_text) : 2);
@@ -805,10 +818,22 @@
 Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
 (or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
 
+	joboptions["account"] = JobOption("Account:", std::string(""), "SNIC Account (project id).\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
+
 	joboptions["timelimit"] = JobOption("Timelimit - format days-hh:mm:ss:", std::string(""), "Timelimit requested for the job.\n\n\
 Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
 (or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
 
+	joboptions["gputype"] = JobOption("GPU type - k80 or v100:", std::string(""), "Which type of GPU to use for GPU jobs.\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
+
+	joboptions["ngpu"] = JobOption("Number of GPU cards to use:", std::string(""), "How many GPU cards of the specified type to use.\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
+
 	joboptions["extrasbatch"] = JobOption("Other sbatch arguments:", std::string(""), "Other arguments to sbatch you want to specify.\n\n\
 Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
 (or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
