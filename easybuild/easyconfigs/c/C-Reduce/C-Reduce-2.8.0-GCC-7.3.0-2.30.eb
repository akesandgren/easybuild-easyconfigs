easyblock = 'CMakeMake'

name = 'C-Reduce'
version = '2.8.0'

homepage = 'http://embed.cs.utah.edu/creduce/'
description = """C-Reduce is a tool that takes a large C, C++, or OpenCL
file that has a property of interest (such as triggering a compiler bug)
and automatically produces a much smaller C/C++ file that has the same
property. It is intended for use by people who discover and report bugs
in compilers and other tools that process source code. C-Reduce is
released under a BSD-like license."""

toolchain = {'name': 'GCC', 'version': '7.3.0-2.30'}

source_urls = ['https://github.com/csmith-project/creduce/archive']
sources = ['creduce-%(version)s.tar.gz']
checksums = ['ce8f2ec77569073cc93191ac4606894a8731e8c118abb197566a12d8ecd65954']

builddependencies = [
    ('CMake', '3.12.1'),
    ('flex', '2.6.4'),
]

dependencies = [
    ('zlib', '1.2.11'),
    ('Perl', '5.28.0'),
    ('Clang', '6.0.1'),
    ('Exporter-Lite', '0.08', '-Perl-%(perlver)s'),
    ('Getopt-Tabular', '0.3', '-Perl-%(perlver)s'),
]

configopts = '-DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ '
configopts += '-DLLVM_DIR=$EBROOTCLANG/lib/cmake/llvm '

sanity_check_paths = {
    'files': ['bin/creduce', 'libexec/clang_delta', 'share/creduce/perl/creduce_config.pm'],
    'dirs': [],
}

moduleclass = 'tools'
